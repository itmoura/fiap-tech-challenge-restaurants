<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker Setup - Tech Challenge Restaurant API</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçΩÔ∏è</text></svg>">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <a href="../" class="logo">
                    <span class="logo-icon">üçΩÔ∏è</span>
                    <div>
                        <div class="logo-text">Tech Challenge</div>
                        <div class="logo-subtitle">Restaurant API</div>
                    </div>
                </a>
            </div>
            
            <div class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">In√≠cio</div>
                    <a href="../" class="nav-item">
                        <span class="nav-item-icon">üè†</span>
                        Vis√£o Geral
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Instala√ß√£o</div>
                    <a href="prerequisites.html" class="nav-item">
                        <span class="nav-item-icon">üìã</span>
                        Pr√©-requisitos
                    </a>
                    <a href="local-setup.html" class="nav-item">
                        <span class="nav-item-icon">‚öôÔ∏è</span>
                        Configura√ß√£o Local
                    </a>
                    <a href="docker.html" class="nav-item active">
                        <span class="nav-item-icon">üê≥</span>
                        Docker
                    </a>
                    <a href="testing.html" class="nav-item">
                        <span class="nav-item-icon">üß™</span>
                        Testes
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">API Reference</div>
                    <a href="api-overview.html" class="nav-item">
                        <span class="nav-item-icon">üìö</span>
                        Vis√£o Geral
                    </a>
                    <a href="kitchen-types.html" class="nav-item">
                        <span class="nav-item-icon">üë®‚Äçüç≥</span>
                        Kitchen Types
                    </a>
                    <a href="restaurants.html" class="nav-item">
                        <span class="nav-item-icon">üè™</span>
                        Restaurants
                    </a>
                    <a href="menu-categories.html" class="nav-item">
                        <span class="nav-item-icon">üìÇ</span>
                        Menu Categories
                    </a>
                    <a href="menu-items.html" class="nav-item">
                        <span class="nav-item-icon">üçï</span>
                        Menu Items
                    </a>
                    <a href="status-codes.html" class="nav-item">
                        <span class="nav-item-icon">üìä</span>
                        Status Codes
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Arquitetura</div>
                    <a href="architecture-overview.html" class="nav-item">
                        <span class="nav-item-icon">üèóÔ∏è</span>
                        Vis√£o Geral
                    </a>
                    <a href="clean-architecture.html" class="nav-item">
                        <span class="nav-item-icon">üéØ</span>
                        Clean Architecture
                    </a>
                    <a href="data-modeling.html" class="nav-item">
                        <span class="nav-item-icon">üóÑÔ∏è</span>
                        Modelagem de Dados
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Sobre</div>
                    <a href="author.html" class="nav-item">
                        <span class="nav-item-icon">üë§</span>
                        Autor
                    </a>
                    <a href="license.html" class="nav-item">
                        <span class="nav-item-icon">üìÑ</span>
                        Licen√ßa
                    </a>
                    <a href="changelog.html" class="nav-item">
                        <span class="nav-item-icon">üìù</span>
                        Changelog
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <nav class="breadcrumb">
                    <a href="../">Home</a>
                    <span>/</span>
                    <a href="#">Instala√ß√£o</a>
                    <span>/</span>
                    <span>Docker</span>
                </nav>
                <h1 class="page-title">üê≥ Docker Setup</h1>
                <p class="page-description">Execute o projeto usando Docker e Docker Compose</p>
            </header>

            <div class="content-body">
                <!-- Quick Start -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">‚ö°</span>
                        <h2 class="card-title">Quick Start com Docker</h2>
                    </div>
                    <div class="card-content">
                        <p>A forma mais r√°pida de executar o projeto:</p>

                        <div class="code-block">
                            <pre># 1. Clone o reposit√≥rio
git clone https://github.com/itmoura/fiap-tech-challenge-restaurants.git
cd fiap-tech-challenge-restaurants

# 2. Execute com Docker Compose
docker-compose up -d

# 3. Verifique os containers
docker-compose ps

# 4. Teste a API
curl http://localhost:8080/api/restaurants</pre>
                        </div>

                        <p class="mt-2">
                            üéâ <strong>Pronto!</strong> A aplica√ß√£o estar√° rodando em 
                            <code>http://localhost:8080</code>
                        </p>
                    </div>
                </div>

                <!-- Docker Compose Structure -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìã</span>
                        <h2 class="card-title">Estrutura do Docker Compose</h2>
                    </div>
                    <div class="card-content">
                        <p>O projeto inclui um <code>docker-compose.yml</code> completo:</p>

                        <div class="code-block">
                            <pre>version: '3.8'

services:
  # Aplica√ß√£o Spring Boot
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - MONGO_URI=mongodb://mongodb:27017/restaurant_db
    depends_on:
      - mongodb
    networks:
      - restaurant-network

  # Banco de dados MongoDB
  mongodb:
    image: mongo:7.0
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_DATABASE=restaurant_db
    volumes:
      - mongodb_data:/data/db
    networks:
      - restaurant-network

volumes:
  mongodb_data:

networks:
  restaurant-network:
    driver: bridge</pre>
                        </div>
                    </div>
                </div>

                <!-- Services Overview -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üèóÔ∏è</span>
                        <h2 class="card-title">Servi√ßos Dispon√≠veis</h2>
                    </div>
                    <div class="card-content">
                        <div class="feature-cards">
                            <div class="feature-card">
                                <div class="feature-card-icon">üçÉ</div>
                                <h3 class="feature-card-title">Spring Boot App</h3>
                                <p class="feature-card-description">
                                    Aplica√ß√£o principal rodando na porta 8080
                                </p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-card-icon">üçÉ</div>
                                <h3 class="feature-card-title">MongoDB</h3>
                                <p class="feature-card-description">
                                    Banco de dados NoSQL na porta 27017
                                </p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-card-icon">üîó</div>
                                <h3 class="feature-card-title">Network</h3>
                                <p class="feature-card-description">
                                    Rede isolada para comunica√ß√£o entre servi√ßos
                                </p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-card-icon">üíæ</div>
                                <h3 class="feature-card-title">Volume</h3>
                                <p class="feature-card-description">
                                    Persist√™ncia de dados do MongoDB
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Docker Commands -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üíª</span>
                        <h2 class="card-title">Comandos Docker Essenciais</h2>
                    </div>
                    <div class="card-content">
                        <h3 class="mb-1">üöÄ Inicializa√ß√£o</h3>
                        <div class="code-block">
                            <pre># Iniciar todos os servi√ßos
docker-compose up -d

# Iniciar com logs vis√≠veis
docker-compose up

# Iniciar apenas um servi√ßo espec√≠fico
docker-compose up -d mongodb</pre>
                        </div>

                        <h3 class="mb-1 mt-2">üìä Monitoramento</h3>
                        <div class="code-block">
                            <pre># Ver status dos containers
docker-compose ps

# Ver logs de todos os servi√ßos
docker-compose logs

# Ver logs de um servi√ßo espec√≠fico
docker-compose logs app
docker-compose logs mongodb

# Seguir logs em tempo real
docker-compose logs -f app</pre>
                        </div>

                        <h3 class="mb-1 mt-2">üîß Gerenciamento</h3>
                        <div class="code-block">
                            <pre># Parar todos os servi√ßos
docker-compose stop

# Parar e remover containers
docker-compose down

# Parar, remover containers e volumes
docker-compose down -v

# Rebuild da aplica√ß√£o
docker-compose build app
docker-compose up -d app</pre>
                        </div>

                        <h3 class="mb-1 mt-2">üêõ Debug</h3>
                        <div class="code-block">
                            <pre># Executar comando dentro do container
docker-compose exec app bash
docker-compose exec mongodb mongosh

# Ver informa√ß√µes detalhadas
docker-compose config
docker inspect &lt;container_id&gt;

# Limpar recursos n√£o utilizados
docker system prune -a</pre>
                        </div>
                    </div>
                </div>

                <!-- Environment Profiles -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">‚öôÔ∏è</span>
                        <h2 class="card-title">Perfis de Ambiente</h2>
                    </div>
                    <div class="card-content">
                        <p>O projeto suporta diferentes perfis para diferentes ambientes:</p>

                        <h3 class="mb-1">üê≥ Perfil Docker</h3>
                        <div class="code-block">
                            <pre># application-docker.yml
spring:
  data:
    mongodb:
      uri: mongodb://mongodb:27017/restaurant_db
  
logging:
  level:
    com.fiap.itmoura.tech_challenge: INFO</pre>
                        </div>

                        <h3 class="mb-1 mt-2">üè† Perfil Local</h3>
                        <div class="code-block">
                            <pre># application-local.yml
spring:
  data:
    mongodb:
      uri: mongodb://localhost:27017/restaurant_db
  
logging:
  level:
    com.fiap.itmoura.tech_challenge: DEBUG</pre>
                        </div>

                        <h3 class="mb-1 mt-2">üß™ Perfil de Teste</h3>
                        <div class="code-block">
                            <pre># application-test.yml
spring:
  data:
    mongodb:
      uri: mongodb://localhost:27017/restaurant_test_db
  
logging:
  level:
    com.fiap.itmoura.tech_challenge: DEBUG</pre>
                        </div>
                    </div>
                </div>

                <!-- Dockerfile -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìÑ</span>
                        <h2 class="card-title">Dockerfile</h2>
                    </div>
                    <div class="card-content">
                        <p>O projeto inclui um Dockerfile otimizado para produ√ß√£o:</p>

                        <div class="code-block">
                            <pre># Multi-stage build para otimiza√ß√£o
FROM openjdk:21-jdk-slim as builder

WORKDIR /app
COPY gradlew .
COPY gradle gradle
COPY build.gradle .
COPY settings.gradle .
COPY src src

# Build da aplica√ß√£o
RUN ./gradlew clean build -x test

# Imagem final otimizada
FROM openjdk:21-jre-slim

WORKDIR /app

# Criar usu√°rio n√£o-root
RUN addgroup --system spring && adduser --system spring --ingroup spring
USER spring:spring

# Copiar JAR da etapa de build
COPY --from=builder /app/build/libs/*.jar app.jar

# Configura√ß√µes de JVM otimizadas
ENV JAVA_OPTS="-Xmx512m -Xms256m -XX:+UseG1GC"

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1

EXPOSE 8080

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]</pre>
                        </div>
                    </div>
                </div>

                <!-- Development Workflow -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üîÑ</span>
                        <h2 class="card-title">Workflow de Desenvolvimento</h2>
                    </div>
                    <div class="card-content">
                        <h3 class="mb-1">üöÄ Desenvolvimento R√°pido</h3>
                        <div class="code-block">
                            <pre># 1. Iniciar apenas o MongoDB
docker-compose up -d mongodb

# 2. Executar aplica√ß√£o localmente
./gradlew bootRun

# 3. Fazer altera√ß√µes no c√≥digo
# 4. Reiniciar aplica√ß√£o automaticamente (Spring DevTools)</pre>
                        </div>

                        <h3 class="mb-1 mt-2">üß™ Testes com Docker</h3>
                        <div class="code-block">
                            <pre># 1. Executar testes com MongoDB em container
docker-compose up -d mongodb
./gradlew test

# 2. Ou executar tudo em containers
docker-compose -f docker-compose.test.yml up --build</pre>
                        </div>

                        <h3 class="mb-1 mt-2">üèóÔ∏è Build e Deploy</h3>
                        <div class="code-block">
                            <pre># 1. Build da imagem
docker-compose build app

# 2. Tag para registry
docker tag fiap-tech-challenge-restaurants_app:latest myregistry/restaurant-api:v1.0.0

# 3. Push para registry
docker push myregistry/restaurant-api:v1.0.0</pre>
                        </div>
                    </div>
                </div>

                <!-- Troubleshooting -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üîß</span>
                        <h2 class="card-title">Troubleshooting</h2>
                    </div>
                    <div class="card-content">
                        <h3 class="mb-1">‚ùå Problemas Comuns</h3>
                        
                        <h4 class="mb-1 mt-2">üîå Porta j√° em uso</h4>
                        <div class="code-block">
                            <pre># Verificar o que est√° usando a porta
lsof -i :8080
lsof -i :27017

# Parar processo espec√≠fico
kill -9 &lt;PID&gt;

# Ou alterar porta no docker-compose.yml
ports:
  - "8081:8080"  # Usar porta 8081 externamente</pre>
                        </div>

                        <h4 class="mb-1 mt-2">üóÑÔ∏è Problemas de conex√£o com MongoDB</h4>
                        <div class="code-block">
                            <pre># Verificar se MongoDB est√° rodando
docker-compose ps mongodb

# Ver logs do MongoDB
docker-compose logs mongodb

# Testar conex√£o manual
docker-compose exec mongodb mongosh</pre>
                        </div>

                        <h4 class="mb-1 mt-2">üèóÔ∏è Problemas de build</h4>
                        <div class="code-block">
                            <pre># Limpar cache do Docker
docker-compose build --no-cache app

# Limpar volumes
docker-compose down -v

# Rebuild completo
docker-compose down
docker-compose build
docker-compose up -d</pre>
                        </div>

                        <h4 class="mb-1 mt-2">üíæ Problemas de persist√™ncia</h4>
                        <div class="code-block">
                            <pre># Verificar volumes
docker volume ls

# Inspecionar volume
docker volume inspect fiap-tech-challenge-restaurants_mongodb_data

# Backup do volume
docker run --rm -v fiap-tech-challenge-restaurants_mongodb_data:/data -v $(pwd):/backup alpine tar czf /backup/mongodb-backup.tar.gz /data</pre>
                        </div>
                    </div>
                </div>

                <!-- Production Considerations -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üè≠</span>
                        <h2 class="card-title">Considera√ß√µes para Produ√ß√£o</h2>
                    </div>
                    <div class="card-content">
                        <div class="feature-cards">
                            <div class="feature-card">
                                <div class="feature-card-icon">üîí</div>
                                <h3 class="feature-card-title">Seguran√ßa</h3>
                                <p class="feature-card-description">
                                    Use secrets, usu√°rios n√£o-root e redes isoladas
                                </p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-card-icon">üìä</div>
                                <h3 class="feature-card-title">Monitoramento</h3>
                                <p class="feature-card-description">
                                    Configure health checks e m√©tricas
                                </p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-card-icon">üíæ</div>
                                <h3 class="feature-card-title">Backup</h3>
                                <p class="feature-card-description">
                                    Implemente estrat√©gia de backup dos volumes
                                </p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-card-icon">‚ö°</div>
                                <h3 class="feature-card-title">Performance</h3>
                                <p class="feature-card-description">
                                    Otimize recursos e configure limites
                                </p>
                            </div>
                        </div>

                        <h3 class="mb-1 mt-2">üîß Exemplo de Produ√ß√£o</h3>
                        <div class="code-block">
                            <pre># docker-compose.prod.yml
version: '3.8'

services:
  app:
    image: myregistry/restaurant-api:v1.0.0
    deploy:
      replicas: 3
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - JAVA_OPTS=-Xmx400m -XX:+UseG1GC
    secrets:
      - mongodb_password
    networks:
      - restaurant-network

  mongodb:
    image: mongo:7.0
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
    volumes:
      - mongodb_data:/data/db
      - ./mongodb.conf:/etc/mongod.conf
    secrets:
      - mongodb_password
    networks:
      - restaurant-network

secrets:
  mongodb_password:
    external: true

networks:
  restaurant-network:
    external: true</pre>
                        </div>
                    </div>
                </div>

                <!-- Next Steps -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üöÄ</span>
                        <h2 class="card-title">Pr√≥ximos Passos</h2>
                    </div>
                    <div class="card-content">
                        <p>Agora que voc√™ tem o ambiente Docker configurado:</p>

                        <div class="feature-cards">
                            <div class="feature-card" data-link="testing.html">
                                <div class="feature-card-icon">üß™</div>
                                <h3 class="feature-card-title">Executar Testes</h3>
                                <p class="feature-card-description">
                                    Aprenda a executar testes no ambiente Docker
                                </p>
                            </div>

                            <div class="feature-card" data-link="api-overview.html">
                                <div class="feature-card-icon">üìö</div>
                                <h3 class="feature-card-title">Explorar API</h3>
                                <p class="feature-card-description">
                                    Conhe√ßa todos os endpoints dispon√≠veis
                                </p>
                            </div>

                            <div class="feature-card" data-link="architecture-overview.html">
                                <div class="feature-card-icon">üèóÔ∏è</div>
                                <h3 class="feature-card-title">Arquitetura</h3>
                                <p class="feature-card-description">
                                    Entenda a estrutura do sistema
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/main.js"></script>
</body>
</html>
